<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Part 2: Piping and producing single-panel ggplot figures • MultiPanelPlotsWithR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Part 2: Piping and producing single-panel ggplot figures">
<meta property="og:description" content="MultiPanelPlotsWithR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MultiPanelPlotsWithR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/group-01_Fundamentals-data-wrangling-tidyverse.html">Part 1: Fundamentals of data wrangling in tidyverse</a>
    </li>
    <li>
      <a href="../articles/group-02_Piping-single-panel-ggplot-figs.html">Part 2: Piping and producing single-panel ggplot figures</a>
    </li>
    <li>
      <a href="../articles/group-03_Using-cowplot-multi-panel.html">Part 3: Using cowplot to construct multi-panel figures</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/flightlab/MultiPanelPlotsWithR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Part 2: Piping and producing single-panel ggplot figures</h1>
                        <h4 class="author">by Vikram B. Baliga, Andrea Gaede and Shreeram Senthivasan</h4>
            
            <h4 class="date">Last updated on 2020-09-22 22:14:26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/flightlab/MultiPanelPlotsWithR/blob/master/vignettes/group-02_Piping-single-panel-ggplot-figs.Rmd"><code>vignettes/group-02_Piping-single-panel-ggplot-figs.Rmd</code></a></small>
      <div class="hidden name"><code>group-02_Piping-single-panel-ggplot-figs.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This vignette is Part 2 of 3 for an R workshop created for <a href="http://www.biology.ubc.ca/course-listing-2/#500level-4">BIOL 548L</a>, a graduate-level course taught at the University of British Columbia.</p>
<p>When the workshop runs, we split students into three groups with successively increasing levels of difficulty. <strong>To make sense of what follows, we recommend working through (or at least looking at) <a href="https://flightlab.github.io/MultiPanelPlotsWithR/articles/group-01_Fundamentals-data-wrangling-tidyverse.html">Part 1’s vignette</a>.</strong></p>
<p>The goal of Part 2’s vignette is to learn how to structure data to produce single plots ready for presentations and publications</p>
<p>Part 3’s vignette (which we recommend going through only <em>after</em> completing this page) can be found <a href="https://flightlab.github.io/MultiPanelPlotsWithR/articles/group-03_Using-cowplot-multi-panel.html">here</a>.</p>
<p>All code and contents of this vignette were written together by Vikram B. Baliga, Andrea Gaede and Shreeram Senthivasan.</p>
</div>
<div id="learning-objectives" class="section level2">
<h2 class="hasAnchor">
<a href="#learning-objectives" class="anchor"></a>Learning Objectives:</h2>
<ol style="list-style-type: decimal">
<li>Articulate the advantages of literate programming</li>
<li>Employ piping to restructure data for tidyverse</li>
<li>Describe the grammar of graphics that underlies plotting in ggplot</li>
<li>Manipulate plots to improve clarity and maximize the data : ink ratio</li>
</ol>
</div>
<div id="load-or-installload-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#load-or-installload-packages" class="anchor"></a>Load or install&amp;load packages</h2>
<p>We’ll first load packages that will be necessary. The <code>package.check()</code> function below is designed to first see if each package is already installed. If any aren’t, the function then installs them from CRAN. Then all the packages are loaded.</p>
<p>The code block is modified from <a href="https://vbaliga.github.io/verify-that-r-packages-are-installed-and-loaded/">this blog post</a></p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co">## Modified from: </span>
<span class="co">## https://vbaliga.github.io/verify-that-r-packages-are-installed-and-loaded/</span>

<span class="co">## First specify the packages of interest</span>
<span class="no">packages</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"gapminder"</span>,
    <span class="st">"ggplot2"</span>,
    <span class="st">"tidyr"</span>,
    <span class="st">"dplyr"</span>,
    <span class="st">"tibble"</span>,
    <span class="st">"readr"</span>,
    <span class="st">"forcats"</span>,
    <span class="st">"readxl"</span>,
    <span class="st">"ggthemes"</span>,
    <span class="st">"magick"</span>,
    <span class="st">"grid"</span>,
    <span class="st">"cowplot"</span>,
    <span class="co"># ggmap and maps are optional; needed for creating maps</span>
    <span class="st">"ggmap"</span>,
    <span class="st">"maps"</span>)

<span class="co">## Now load or install&amp;load all packages</span>
<span class="no">package.check</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(
    <span class="no">packages</span>,
    <span class="kw">FUN</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>)
    {
      <span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="no">x</span>, <span class="kw">character.only</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
      {
        <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="no">x</span>, <span class="kw">dependencies</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                         <span class="kw">repos</span> <span class="kw">=</span> <span class="st">"http://cran.us.r-project.org"</span>)
        <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">x</span>, <span class="kw">character.only</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
      }
    }
  )</pre></body></html></div>
<div id="data-sets" class="section level3">
<h3 class="hasAnchor">
<a href="#data-sets" class="anchor"></a>Data sets</h3>
<p>You can get all data used in this vignette (and the other two!) by downloading <a href="ADD%20NEW%20LINK%20HERE">this zip file</a>.</p>
</div>
</div>
<div id="what-is-literate-programming" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-literate-programming" class="anchor"></a>What is literate programming?</h2>
<p>“Literate programming” rethinks the “grammar” of traditional code to more closely resemble writing in a human language, like English.</p>
<p>The primary goal of literate programming is to move away from coding “for computers” (ie, code that simplifies compilation) and instead to write in a way that more resembles how we think.</p>
<p>In addition to making for much more readable code even with fewer comments, a good literate coding language should make it easier for you to translate ideas into code.</p>
<p>In the <code>tidyverse</code>, we will largely use the analogy of variables as nouns and functions as verbs that operate on the nouns.</p>
<p>The main way we will make our code literate however is with the pipe: <code>%&gt;%</code></p>
</div>
<div id="what-is-a-pipe" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-a-pipe" class="anchor"></a>What is a pipe?</h2>
<p>A pipe, or <code>%&gt;%</code>, is an operator that takes everything on the left and plugs it into the function on the right.</p>
<p>In short: <code>x %&gt;% f(y)</code> is equivalent to <code>f(x, y)</code></p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># So:</span>
<span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">gapminder</span>, <span class="no">continent</span> <span class="kw">==</span> <span class="st">'Asia'</span>)
<span class="co">#&gt; # A tibble: 396 x 6</span>
<span class="co">#&gt;    country     continent  year lifeExp      pop gdpPercap</span>
<span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Afghanistan Asia       1952    28.8  8425333      779.</span>
<span class="co">#&gt;  2 Afghanistan Asia       1957    30.3  9240934      821.</span>
<span class="co">#&gt;  3 Afghanistan Asia       1962    32.0 10267083      853.</span>
<span class="co">#&gt;  4 Afghanistan Asia       1967    34.0 11537966      836.</span>
<span class="co">#&gt;  5 Afghanistan Asia       1972    36.1 13079460      740.</span>
<span class="co">#&gt;  6 Afghanistan Asia       1977    38.4 14880372      786.</span>
<span class="co">#&gt;  7 Afghanistan Asia       1982    39.9 12881816      978.</span>
<span class="co">#&gt;  8 Afghanistan Asia       1987    40.8 13867957      852.</span>
<span class="co">#&gt;  9 Afghanistan Asia       1992    41.7 16317921      649.</span>
<span class="co">#&gt; 10 Afghanistan Asia       1997    41.8 22227415      635.</span>
<span class="co">#&gt; # … with 386 more rows</span>

<span class="co"># Can be re-written as:</span>
<span class="no">gapminder</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">continent</span> <span class="kw">==</span> <span class="st">'Asia'</span>)
<span class="co">#&gt; # A tibble: 396 x 6</span>
<span class="co">#&gt;    country     continent  year lifeExp      pop gdpPercap</span>
<span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Afghanistan Asia       1952    28.8  8425333      779.</span>
<span class="co">#&gt;  2 Afghanistan Asia       1957    30.3  9240934      821.</span>
<span class="co">#&gt;  3 Afghanistan Asia       1962    32.0 10267083      853.</span>
<span class="co">#&gt;  4 Afghanistan Asia       1967    34.0 11537966      836.</span>
<span class="co">#&gt;  5 Afghanistan Asia       1972    36.1 13079460      740.</span>
<span class="co">#&gt;  6 Afghanistan Asia       1977    38.4 14880372      786.</span>
<span class="co">#&gt;  7 Afghanistan Asia       1982    39.9 12881816      978.</span>
<span class="co">#&gt;  8 Afghanistan Asia       1987    40.8 13867957      852.</span>
<span class="co">#&gt;  9 Afghanistan Asia       1992    41.7 16317921      649.</span>
<span class="co">#&gt; 10 Afghanistan Asia       1997    41.8 22227415      635.</span>
<span class="co">#&gt; # … with 386 more rows</span></pre></body></html></div>
<p>In RStudio you can use the shortcut <code>CTRL + SHIFT + M</code> (on Windows) or <code>CMD + SHIFT + M</code> (on Mac) to insert a pipe</p>
</div>
<div id="why-bother-with-pipes" class="section level2">
<h2 class="hasAnchor">
<a href="#why-bother-with-pipes" class="anchor"></a>Why bother with pipes?</h2>
<p>To see how pipes can make code more readable, let’s translate this cake recipe into pseudo R code:</p>
<ol style="list-style-type: decimal">
<li>Cream together sugar and butter</li>
<li>Beat in eggs and vanilla</li>
<li>Mix in flour and baking powder</li>
<li>Stir in milk</li>
<li>Bake</li>
<li>Frost</li>
</ol>
<p><strong>Saving Intermediate Steps:</strong><br>
One way you might approach coding this is by defining a lot of variables:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">batter_1</span>   <span class="kw">&lt;-</span> <span class="fu">cream</span>(<span class="no">sugar</span>, <span class="no">butter</span>)
<span class="no">batter_2</span>   <span class="kw">&lt;-</span> <span class="fu">beat_in</span>(<span class="no">batter_1</span>, <span class="no">eggs</span>, <span class="no">vanilla</span>)
<span class="no">batter_3</span>   <span class="kw">&lt;-</span> <span class="fu">mix_in</span>(<span class="no">batter_2</span>, <span class="no">flour</span>, <span class="no">baking_powder</span>)
<span class="no">batter_4</span>   <span class="kw">&lt;-</span> <span class="fu">stir_in</span>(<span class="no">batter_3</span>, <span class="no">milk</span>)
<span class="no">cake</span>       <span class="kw">&lt;-</span> <span class="fu">bake</span>(<span class="no">batter_3</span>)
<span class="no">cake_final</span> <span class="kw">&lt;-</span> <span class="fu">frost</span>(<span class="no">cake</span>)</pre></body></html></div>
<p>The info is all there, but there’s a lot of repetition and opportunity for typos. You also have to jump back and forth between lines to make sure you’re calling the right variables.</p>
<p>A similar approach would be to keep overwriting a single variable:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">cake</span> <span class="kw">&lt;-</span> <span class="fu">cream</span>(<span class="no">sugar</span>, <span class="no">butter</span>)
<span class="no">cake</span> <span class="kw">&lt;-</span> <span class="fu">beat_in</span>(<span class="no">cake</span>, <span class="no">eggs</span>, <span class="no">vanilla</span>)
<span class="no">cake</span> <span class="kw">&lt;-</span> <span class="fu">mix_in</span>(<span class="no">cake</span>, <span class="no">flour</span>, <span class="no">baking_powder</span>)
<span class="no">cake</span> <span class="kw">&lt;-</span> <span class="fu">stir_in</span>(<span class="no">cake</span>, <span class="no">milk</span>)
<span class="no">cake</span> <span class="kw">&lt;-</span> <span class="fu">bake</span>(<span class="no">cake</span>)
<span class="no">cake</span> <span class="kw">&lt;-</span> <span class="fu">frost</span>(<span class="no">cake</span>)</pre></body></html></div>
<p>But it’s still not as clear as the original recipe…And if anything goes wrong you have to re-run the whole pipeline.</p>
<p><strong>Function Composition:</strong><br>
If we don’t want to save intermediates, we can just do all the steps in one line:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu">frost</span>(<span class="fu">bake</span>(<span class="fu">stir_in</span>(<span class="fu">mix_in</span>(<span class="fu">beat_in</span>(<span class="fu">cream</span>(<span class="no">sugar</span>, <span class="no">butter</span>), <span class="no">eggs</span>, <span class="no">vanilla</span>), <span class="no">flour</span>, <span class="no">baking_powder</span>), <span class="no">milk</span>)))</pre></body></html></div>
<p>Or with better indentation:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu">frost</span>(
    <span class="fu">bake</span>(
      <span class="fu">stir_in</span>(
        <span class="fu">mix_in</span>(
          <span class="fu">beat_in</span>(
            <span class="fu">cream</span>(<span class="no">sugar</span>, <span class="no">butter</span>),
            <span class="no">eggs</span>,
            <span class="no">vanilla</span>
          ),
          <span class="no">flour</span>, <span class="no">baking_powder</span>
        ),
      <span class="no">milk</span>)
    )
  )</pre></body></html></div>
<p>It’s pretty clear why this is no good</p>
</div>
<div id="piping" class="section level2">
<h2 class="hasAnchor">
<a href="#piping" class="anchor"></a>Piping</h2>
<p><strong>Now for the piping approach:</strong></p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">cake</span> <span class="kw">&lt;-</span>
    <span class="fu">cream</span>(<span class="no">sugar</span>, <span class="no">butter</span>) <span class="kw">%&gt;%</span>
    <span class="fu">beat_in</span>(<span class="no">eggs</span>, <span class="no">vanilla</span>) <span class="kw">%&gt;%</span>
    <span class="fu">mix_in</span>(<span class="no">flour</span>, <span class="no">baking_powder</span>) <span class="kw">%&gt;%</span>
    <span class="fu">stir_in</span>(<span class="no">milk</span>) <span class="kw">%&gt;%</span>
    <span class="fu">bake</span>() <span class="kw">%&gt;%</span>
    <span class="fu">frost</span>()</pre></body></html></div>
<p>When you are reading code, you can replace pipes with the phrase “and then.”</p>
<p>And remember, pipes just take everything on the left and plug it into the function on the right. If you step through this code, this chunk is exactly the same as the function composition example above, it’s just written for people to read.</p>
<p>When you chain together multiple manipulations, piping makes it easy to focus on what’s important at every step. One caveat is that you need the first argument of every function in the pipe to be the object you are manipulating. Tidyverse functions all follow this convention, as do many other functions.</p>
<p><strong>Where do you find new verbs?</strong></p>
<p>The RStudio cheat sheets are a whole lot more useful once you start piping – here are a few:</p>
<ul>
<li><p><a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf">Data transformation</a></p></li>
<li><p><a href="https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf">Data import and restructuring</a></p></li>
<li><p><a href="https://www.rstudio.com/resources/cheatsheets/">Other cheat sheets</a></p></li>
</ul>
</div>
<div id="some-prep-work-for-the-coding-part-of-the-lesson" class="section level2">
<h2 class="hasAnchor">
<a href="#some-prep-work-for-the-coding-part-of-the-lesson" class="anchor"></a>Some prep work for the coding part of the lesson:</h2>
<p>In this section our main goal will be to reproduce as closely as possible all the individual plots that make up Figure 3 in the <a href="https://www.cell.com/current-biology/fulltext/S0960-9822(16)31394-X">Gaede et al. 2017 paper</a>.</p>
<p>The one exception to that will be the legends and icons, which are easier to align and arrange when organizing the plots into a single multipanel figure, which is left for Group 3.</p>
<p>Let’s start by opening up the paper and setting up some variables we will be using throughout the plotting.</p>
<p><strong>Colours for the different birds</strong></p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">col_hb</span> <span class="kw">&lt;-</span> <span class="st">"#ED0080"</span>
<span class="no">col_zb</span> <span class="kw">&lt;-</span> <span class="st">"#F48D00"</span>
<span class="no">col_pg</span> <span class="kw">&lt;-</span> <span class="st">"#4AA4F2"</span></pre></body></html></div>
</div>
<div id="anatomy-of-a-ggplot" class="section level2">
<h2 class="hasAnchor">
<a href="#anatomy-of-a-ggplot" class="anchor"></a>Anatomy of a ggplot</h2>
<p><code>ggplot2</code> is built around the idea of a “Grammar of Graphics” – a way of describing (almost) any graphic.</p>
<p>There are three key components to any graphic under the Grammar of Graphics:</p>
<ul>
<li>Data: the information to be conveyed</li>
<li>Geometries: the things you actually draw on the plot (lines, points, polygons, etc…)</li>
<li>Aesthetic mapping: the connection between relevant parts of the data and the aesthetics (size, colour, position, etc…) of the geometries</li>
</ul>
<p>Any ggplot you make will at the very minimum require these three things and will usually look something like this:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">my_data</span>, <span class="kw">mapping</span> <span class="kw">=</span> <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">var1</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">var2</span>)) +
  <span class="fu">geom_point</span>()</pre></body></html></div>
<p>Or, equivalently:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">my_data</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">var1</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">var2</span>)) +
  <span class="fu">geom_point</span>()</pre></body></html></div>
<p>But how do you know what geometries are available or what aesthetic mappings you can use for each? Use the <a href="https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf">plotting with ggplot2 cheat sheet</a></p>
<p>Other possibly relevant componenets include:</p>
<ul>
<li>Coordinate systems (eg cartesian vs polar plots)</li>
<li>Scales (eg mapping specifc colours to groups)</li>
<li>Facets (subpanels of similar plots)</li>
</ul>
</div>
<div id="build-a-boxplot-with-data-superimposed-figure-3-panel-d" class="section level2">
<h2 class="hasAnchor">
<a href="#build-a-boxplot-with-data-superimposed-figure-3-panel-d" class="anchor"></a>Build a boxplot with data superimposed (Figure 3 Panel D):</h2>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">data_D</span> <span class="kw">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Fig3D_data.csv"</span>)
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   species = col_character(),</span>
<span class="co">#&gt;   perc_firing = col_double(),</span>
<span class="co">#&gt;   num_bins = col_double()</span>
<span class="co">#&gt; )</span>

<span class="co"># Visualize data</span>
<span class="no">data_D</span>
<span class="co">#&gt; # A tibble: 2,400 x 3</span>
<span class="co">#&gt;    species perc_firing num_bins</span>
<span class="co">#&gt;    &lt;chr&gt;         &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 calan          0.5         4</span>
<span class="co">#&gt;  2 calan          0.55        4</span>
<span class="co">#&gt;  3 calan          0.6         4</span>
<span class="co">#&gt;  4 calan          0.65        4</span>
<span class="co">#&gt;  5 calan          0.7         3</span>
<span class="co">#&gt;  6 calan          0.75        3</span>
<span class="co">#&gt;  7 calan          0.8         1</span>
<span class="co">#&gt;  8 calan          0.85        1</span>
<span class="co">#&gt;  9 calan          0.9         1</span>
<span class="co">#&gt; 10 calan          0.95        1</span>
<span class="co">#&gt; # … with 2,390 more rows</span></pre></body></html></div>
<p><strong>Let’s make a ggplot!</strong></p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">data_D</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="kw">mapping</span> <span class="kw">=</span> <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">perc_firing</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">num_bins</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="no">species</span>))</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p><strong>Add points:</strong></p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">data_D</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="kw">mapping</span> <span class="kw">=</span> <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">perc_firing</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">num_bins</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_point</span>(<span class="kw">mapping</span> <span class="kw">=</span> <span class="fu">aes</span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">species</span>))</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p><strong>Separate points:</strong></p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">data_D</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">perc_firing</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">num_bins</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">species</span>), <span class="kw">position</span> <span class="kw">=</span> <span class="st">'jitter'</span>)</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p><strong>Add summary statistics:</strong></p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">data_D</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">perc_firing</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">num_bins</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">species</span>), <span class="kw">position</span> <span class="kw">=</span> <span class="st">'jitter'</span>) +
    <span class="fu">geom_boxplot</span>()</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p><strong>Fix x axis:</strong></p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">data_D</span> <span class="kw">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Fig3D_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">perc_firing</span> <span class="kw">=</span> <span class="no">perc_firing</span> * <span class="fl">100</span>,
    <span class="kw">perc_firing</span> <span class="kw">=</span> <span class="fu">as_factor</span>(<span class="no">perc_firing</span>)
  )
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   species = col_character(),</span>
<span class="co">#&gt;   perc_firing = col_double(),</span>
<span class="co">#&gt;   num_bins = col_double()</span>
<span class="co">#&gt; )</span></pre></body></html></div>
<p><strong>Re-plot with new x:</strong></p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">data_D</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">perc_firing</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">num_bins</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">species</span>), <span class="kw">position</span> <span class="kw">=</span> <span class="st">'jitter'</span>) +
    <span class="fu">geom_boxplot</span>()</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p><strong>Swap colour to fill:</strong></p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">data_D</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">perc_firing</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">num_bins</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">species</span>), <span class="kw">position</span> <span class="kw">=</span> <span class="st">'jitter'</span>) +
    <span class="fu">geom_boxplot</span>()</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p><strong>Fix colours:</strong></p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="co"># browseURL("http://www.sthda.com/english/wiki/ggplot2-point-shapes")</span>
<span class="no">data_D</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">perc_firing</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">num_bins</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">species</span>), <span class="kw">position</span> <span class="kw">=</span> <span class="st">'jitter'</span>) +
    <span class="fu">geom_boxplot</span>() +
    <span class="fu">scale_fill_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">col_hb</span>, <span class="no">col_zb</span>)) +
    <span class="fu">scale_shape_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">24</span>, <span class="fl">21</span>))</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p><strong>De-emphasize boxplots, remove outliers</strong></p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">data_D</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">perc_firing</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">num_bins</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_boxplot</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">outlier.size</span> <span class="kw">=</span> <span class="fl">0</span>) +
    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">species</span>), <span class="kw">position</span> <span class="kw">=</span> <span class="st">'jitter'</span>) +
    <span class="fu">scale_fill_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">col_hb</span>, <span class="no">col_zb</span>)) +
    <span class="fu">scale_shape_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">24</span>, <span class="fl">21</span>))</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p><strong>Tune jitter:</strong></p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">data_D</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">perc_firing</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">num_bins</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_boxplot</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">outlier.size</span> <span class="kw">=</span> <span class="fl">0</span>) +
    <span class="fu">geom_point</span>(
      <span class="fu">aes</span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">species</span>),
      <span class="kw">position</span> <span class="kw">=</span> <span class="fu">position_jitterdodge</span>(<span class="kw">jitter.height</span> <span class="kw">=</span> <span class="fl">0.3</span>,
                                      <span class="kw">jitter.width</span> <span class="kw">=</span> <span class="fl">0.2</span>)
    ) +
    <span class="fu">scale_fill_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">col_hb</span>, <span class="no">col_zb</span>)) +
    <span class="fu">scale_shape_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">24</span>, <span class="fl">21</span>))</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p><strong>Titles and theming and save:</strong></p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">fig_D</span> <span class="kw">&lt;-</span> <span class="no">data_D</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">perc_firing</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">num_bins</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_boxplot</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">outlier.size</span> <span class="kw">=</span> <span class="fl">0</span>) +
    <span class="fu">geom_point</span>(
      <span class="fu">aes</span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">species</span>),
      <span class="kw">position</span> <span class="kw">=</span> <span class="fu">position_jitterdodge</span>(<span class="kw">jitter.height</span> <span class="kw">=</span> <span class="fl">0.3</span>,
                                      <span class="kw">jitter.width</span> <span class="kw">=</span> <span class="fl">0.2</span>)
    ) +
    <span class="fu">scale_fill_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">col_hb</span>, <span class="no">col_zb</span>)) +
    <span class="fu">scale_shape_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">24</span>, <span class="fl">21</span>)) +
    <span class="fu">labs</span>(
      <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Percent of maximum firing rate (threshold)"</span>,
      <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Number of speed bins above threshold"</span>
    ) +
    <span class="co"># theme_bw()</span>
    <span class="co"># theme_light()</span>
    <span class="co"># theme_dark()</span>
    <span class="fu">theme_classic</span>()
<span class="no">fig_D</span></pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p><strong>Let’s create a theme:</strong></p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">theme_548</span> <span class="kw">&lt;-</span> <span class="fu">theme_classic</span>() +
    <span class="fu">theme</span>(
      <span class="kw">axis.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">13</span>),
      <span class="kw">axis.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">13</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="st">"black"</span>),
      <span class="kw">axis.line</span> <span class="kw">=</span> <span class="fu">element_blank</span>()
    )</pre></body></html></div>
<p><strong>Let’s see what it looks like</strong></p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">fig_D</span> + <span class="no">theme_548</span></pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<p><strong>Let’s create a theme:</strong></p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">theme_548</span> <span class="kw">&lt;-</span> <span class="fu">theme_classic</span>() +
    <span class="fu">theme</span>(
      <span class="co"># Text</span>
      <span class="kw">axis.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">13</span>),
      <span class="kw">axis.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">13</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="st">"black"</span>),
      <span class="kw">axis.text.x</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">margin</span> <span class="kw">=</span> <span class="fu">margin</span>(<span class="kw">t</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">unit</span> <span class="kw">=</span> <span class="st">"pt"</span>)),
      <span class="kw">axis.text.y</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">margin</span> <span class="kw">=</span> <span class="fu">margin</span>(<span class="kw">r</span> <span class="kw">=</span> <span class="fl">10</span>)),
      <span class="co"># Axis line</span>
      <span class="kw">axis.line</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
      <span class="kw">axis.ticks.length</span> <span class="kw">=</span> <span class="fu">unit</span>(-<span class="fl">5</span>,<span class="st">"pt"</span>),
      <span class="co"># Legend</span>
      <span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>,
      <span class="co"># Background transparency</span>
        <span class="co"># Background of panel</span>
      <span class="kw">panel.background</span> <span class="kw">=</span> <span class="fu">element_rect</span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="st">"transparent"</span>),
        <span class="co"># Background behind actual data points</span>
      <span class="kw">plot.background</span> <span class="kw">=</span> <span class="fu">element_rect</span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="st">"transparent"</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="fl">NA</span>)
    )

<span class="no">fig_D</span> + <span class="no">theme_548</span></pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<p><strong>Draw in x and y axes:</strong></p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">data_D</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">perc_firing</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">num_bins</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_boxplot</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">outlier.size</span> <span class="kw">=</span> <span class="fl">0</span>) +
    <span class="fu">geom_point</span>(
      <span class="fu">aes</span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">species</span>),
      <span class="kw">position</span> <span class="kw">=</span> <span class="fu">position_jitterdodge</span>(<span class="kw">jitter.height</span> <span class="kw">=</span> <span class="fl">0.3</span>,
                                      <span class="kw">jitter.width</span> <span class="kw">=</span> <span class="fl">0.2</span>)
    ) +
    <span class="fu">scale_fill_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">col_hb</span>, <span class="no">col_zb</span>)) +
    <span class="fu">scale_shape_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">24</span>, <span class="fl">21</span>)) +
    <span class="fu">labs</span>(
      <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Percent of maximum firing rate (threshold)"</span>,
      <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Number of speed bins above threshold"</span>
    ) +
    <span class="no">theme_548</span> +
    <span class="kw pkg">ggthemes</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/geom_rangeframe.html">geom_rangeframe</a></span>()</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<p><strong>Draw in x and y axes:</strong></p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">fig_D</span> <span class="kw">&lt;-</span> <span class="no">data_D</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">perc_firing</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">num_bins</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_boxplot</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">outlier.size</span> <span class="kw">=</span> <span class="fl">0</span>) +
    <span class="fu">geom_point</span>(
      <span class="fu">aes</span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="no">species</span>),
      <span class="kw">position</span> <span class="kw">=</span> <span class="fu">position_jitterdodge</span>(<span class="kw">jitter.height</span> <span class="kw">=</span> <span class="fl">0.3</span>,
                                      <span class="kw">jitter.width</span> <span class="kw">=</span> <span class="fl">0.2</span>)
    ) +
    <span class="fu">scale_fill_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">col_hb</span>, <span class="no">col_zb</span>)) +
    <span class="fu">scale_shape_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">24</span>, <span class="fl">21</span>)) +
    <span class="fu">labs</span>(
      <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Percent of maximum firing rate (threshold)"</span>,
      <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Number of speed bins above threshold"</span>
    ) +
    <span class="no">theme_548</span> +
    <span class="fu">geom_rangeframe</span>() +
    <span class="fu">annotate</span>(<span class="kw">geom</span> <span class="kw">=</span> <span class="st">"segment"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">xend</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="fl">2.5</span>, <span class="kw">yend</span> <span class="kw">=</span> <span class="fl">10</span>)
<span class="no">fig_D</span></pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
</div>
<div id="build-a-grouped-barplot-figure-3-panel-e" class="section level2">
<h2 class="hasAnchor">
<a href="#build-a-grouped-barplot-figure-3-panel-e" class="anchor"></a>Build a grouped barplot (Figure 3 Panel E):</h2>
<p><strong>Visualize the data:</strong></p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="fu">read_csv</span>(<span class="st">"./Fig3E_data.csv"</span>)
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   `0.1` = col_double(),</span>
<span class="co">#&gt;   `0.24` = col_double(),</span>
<span class="co">#&gt;   `0.5` = col_double(),</span>
<span class="co">#&gt;   `1` = col_double(),</span>
<span class="co">#&gt;   `1.5` = col_double(),</span>
<span class="co">#&gt;   `2` = col_double(),</span>
<span class="co">#&gt;   `4` = col_double(),</span>
<span class="co">#&gt;   `8` = col_double(),</span>
<span class="co">#&gt;   `16` = col_double(),</span>
<span class="co">#&gt;   `24` = col_double(),</span>
<span class="co">#&gt;   `32` = col_double(),</span>
<span class="co">#&gt;   `48` = col_double(),</span>
<span class="co">#&gt;   `64` = col_double(),</span>
<span class="co">#&gt;   `80` = col_double(),</span>
<span class="co">#&gt;   `128` = col_double(),</span>
<span class="co">#&gt;   `256` = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; # A tibble: 3 x 16</span>
<span class="co">#&gt;   `0.1` `0.24`  `0.5`    `1`  `1.5`     `2`     `4`    `8`   `16`   `24`   `32`</span>
<span class="co">#&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1     0 0.0357 0.0179 0      0      0.107   0.0357  0.0357 0.0536 0.0893 0.0714</span>
<span class="co">#&gt; 2     0 0      0      0.0187 0      0.00935 0.00935 0.0935 0.168  0.121  0.187 </span>
<span class="co">#&gt; 3     0 0      0.0947 0.0526 0.0105 0.126   0.126   0.0842 0.147  0      0.147 </span>
<span class="co">#&gt; # … with 5 more variables: `48` &lt;dbl&gt;, `64` &lt;dbl&gt;, `80` &lt;dbl&gt;, `128` &lt;dbl&gt;,</span>
<span class="co">#&gt; #   `256` &lt;dbl&gt;</span></pre></body></html></div>
<p><strong>Restructure data for plotting:</strong></p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="co"># Add the missing info</span>
<span class="fu">read_csv</span>(<span class="st">"./Fig3E_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">species</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"hb"</span>, <span class="st">"zb"</span>, <span class="st">"pg"</span>))
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   `0.1` = col_double(),</span>
<span class="co">#&gt;   `0.24` = col_double(),</span>
<span class="co">#&gt;   `0.5` = col_double(),</span>
<span class="co">#&gt;   `1` = col_double(),</span>
<span class="co">#&gt;   `1.5` = col_double(),</span>
<span class="co">#&gt;   `2` = col_double(),</span>
<span class="co">#&gt;   `4` = col_double(),</span>
<span class="co">#&gt;   `8` = col_double(),</span>
<span class="co">#&gt;   `16` = col_double(),</span>
<span class="co">#&gt;   `24` = col_double(),</span>
<span class="co">#&gt;   `32` = col_double(),</span>
<span class="co">#&gt;   `48` = col_double(),</span>
<span class="co">#&gt;   `64` = col_double(),</span>
<span class="co">#&gt;   `80` = col_double(),</span>
<span class="co">#&gt;   `128` = col_double(),</span>
<span class="co">#&gt;   `256` = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; # A tibble: 3 x 17</span>
<span class="co">#&gt;   `0.1` `0.24`  `0.5`    `1`  `1.5`     `2`     `4`    `8`   `16`   `24`   `32`</span>
<span class="co">#&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1     0 0.0357 0.0179 0      0      0.107   0.0357  0.0357 0.0536 0.0893 0.0714</span>
<span class="co">#&gt; 2     0 0      0      0.0187 0      0.00935 0.00935 0.0935 0.168  0.121  0.187 </span>
<span class="co">#&gt; 3     0 0      0.0947 0.0526 0.0105 0.126   0.126   0.0842 0.147  0      0.147 </span>
<span class="co">#&gt; # … with 6 more variables: `48` &lt;dbl&gt;, `64` &lt;dbl&gt;, `80` &lt;dbl&gt;, `128` &lt;dbl&gt;,</span>
<span class="co">#&gt; #   `256` &lt;dbl&gt;, species &lt;chr&gt;</span>

<span class="co"># Pull the y-values down from the header</span>
<span class="no">data_E</span> <span class="kw">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./Fig3E_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">species</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"hb"</span>, <span class="st">"zb"</span>, <span class="st">"pg"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">gather</span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="no">prop</span>, -<span class="no">species</span>)
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   `0.1` = col_double(),</span>
<span class="co">#&gt;   `0.24` = col_double(),</span>
<span class="co">#&gt;   `0.5` = col_double(),</span>
<span class="co">#&gt;   `1` = col_double(),</span>
<span class="co">#&gt;   `1.5` = col_double(),</span>
<span class="co">#&gt;   `2` = col_double(),</span>
<span class="co">#&gt;   `4` = col_double(),</span>
<span class="co">#&gt;   `8` = col_double(),</span>
<span class="co">#&gt;   `16` = col_double(),</span>
<span class="co">#&gt;   `24` = col_double(),</span>
<span class="co">#&gt;   `32` = col_double(),</span>
<span class="co">#&gt;   `48` = col_double(),</span>
<span class="co">#&gt;   `64` = col_double(),</span>
<span class="co">#&gt;   `80` = col_double(),</span>
<span class="co">#&gt;   `128` = col_double(),</span>
<span class="co">#&gt;   `256` = col_double()</span>
<span class="co">#&gt; )</span>
<span class="no">data_E</span>
<span class="co">#&gt; # A tibble: 48 x 3</span>
<span class="co">#&gt;    species speed   prop</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 hb      0.1   0     </span>
<span class="co">#&gt;  2 zb      0.1   0     </span>
<span class="co">#&gt;  3 pg      0.1   0     </span>
<span class="co">#&gt;  4 hb      0.24  0.0357</span>
<span class="co">#&gt;  5 zb      0.24  0     </span>
<span class="co">#&gt;  6 pg      0.24  0     </span>
<span class="co">#&gt;  7 hb      0.5   0.0179</span>
<span class="co">#&gt;  8 zb      0.5   0     </span>
<span class="co">#&gt;  9 pg      0.5   0.0947</span>
<span class="co">#&gt; 10 hb      1     0     </span>
<span class="co">#&gt; # … with 38 more rows</span></pre></body></html></div>
<p><strong>Plot data:</strong></p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="no">data_E</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">prop</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_col</span>()</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<div class="sourceCode" id="cb31"><html><body><pre class="r">
<span class="co"># But wait, the x-axis and species are out of order!</span>
<span class="no">data_E</span>
<span class="co">#&gt; # A tibble: 48 x 3</span>
<span class="co">#&gt;    species speed   prop</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 hb      0.1   0     </span>
<span class="co">#&gt;  2 zb      0.1   0     </span>
<span class="co">#&gt;  3 pg      0.1   0     </span>
<span class="co">#&gt;  4 hb      0.24  0.0357</span>
<span class="co">#&gt;  5 zb      0.24  0     </span>
<span class="co">#&gt;  6 pg      0.24  0     </span>
<span class="co">#&gt;  7 hb      0.5   0.0179</span>
<span class="co">#&gt;  8 zb      0.5   0     </span>
<span class="co">#&gt;  9 pg      0.5   0.0947</span>
<span class="co">#&gt; 10 hb      1     0     </span>
<span class="co">#&gt; # … with 38 more rows</span>

<span class="no">data_E</span> <span class="kw">&lt;-</span> <span class="no">data_E</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">species</span> <span class="kw">=</span> <span class="fu">fct_relevel</span>(<span class="no">species</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"hb"</span>,<span class="st">"zb"</span>,<span class="st">"pg"</span>)),
    <span class="kw">speed</span> <span class="kw">=</span> <span class="fu">as_factor</span>(<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">speed</span>))
  )
<span class="no">data_E</span>
<span class="co">#&gt; # A tibble: 48 x 3</span>
<span class="co">#&gt;    species speed   prop</span>
<span class="co">#&gt;    &lt;fct&gt;   &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 hb      0.1   0     </span>
<span class="co">#&gt;  2 zb      0.1   0     </span>
<span class="co">#&gt;  3 pg      0.1   0     </span>
<span class="co">#&gt;  4 hb      0.24  0.0357</span>
<span class="co">#&gt;  5 zb      0.24  0     </span>
<span class="co">#&gt;  6 pg      0.24  0     </span>
<span class="co">#&gt;  7 hb      0.5   0.0179</span>
<span class="co">#&gt;  8 zb      0.5   0     </span>
<span class="co">#&gt;  9 pg      0.5   0.0947</span>
<span class="co">#&gt; 10 hb      1     0     </span>
<span class="co">#&gt; # … with 38 more rows</span></pre></body></html></div>
<p><strong>Plot data again!</strong></p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">data_E</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">prop</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_col</span>()</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<div class="sourceCode" id="cb33"><html><body><pre class="r">
<span class="co"># Unstack columns and add black outline</span>
<span class="no">data_E</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">prop</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_col</span>(<span class="kw">position</span> <span class="kw">=</span> <span class="st">'dodge'</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="st">"black"</span>)</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-32-2.png" width="700"></p>
<div class="sourceCode" id="cb34"><html><body><pre class="r">
<span class="co"># Space out column groups, thin out the columns, thin the outline</span>
<span class="no">data_E</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">prop</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_col</span>(
      <span class="kw">position</span> <span class="kw">=</span> <span class="fu">position_dodge</span>(<span class="fl">0.75</span>),
      <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0.75</span>,
      <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.2</span>,
      <span class="kw">colour</span> <span class="kw">=</span> <span class="st">"black"</span>
    )</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-32-3.png" width="700"></p>
<p><strong>Pick colours, add labels, add theme:</strong></p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="no">data_E</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">prop</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="fu">geom_col</span>(
      <span class="kw">position</span> <span class="kw">=</span> <span class="fu">position_dodge</span>(<span class="fl">0.75</span>),
      <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0.75</span>,
      <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.2</span>,
      <span class="kw">colour</span> <span class="kw">=</span> <span class="st">"black"</span>
    ) +
    <span class="fu">scale_fill_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">col_hb</span>, <span class="no">col_zb</span>, <span class="no">col_pg</span>)) +
    <span class="fu">labs</span>(
      <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Speed bins (degrees/s)"</span>,
      <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Proportion of LM\ncell population"</span>
    )+
    <span class="no">theme_548</span></pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
<p><strong>Fix x axis, add y axis line:</strong></p>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="no">fig_E</span> <span class="kw">&lt;-</span> <span class="no">data_E</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">prop</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="co"># Plot data</span>
    <span class="fu">geom_col</span>(
      <span class="kw">position</span> <span class="kw">=</span> <span class="fu">position_dodge</span>(<span class="fl">0.75</span>),
      <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0.75</span>,
      <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.2</span>,
      <span class="kw">colour</span> <span class="kw">=</span> <span class="st">"black"</span>
    ) +
    <span class="co"># Pick colours</span>
    <span class="fu">scale_fill_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">col_hb</span>, <span class="no">col_zb</span>, <span class="no">col_pg</span>)) +
    <span class="co"># Text</span>
    <span class="fu">labs</span>(
      <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Speed bins (degrees/s)"</span>,
      <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Proportion of LM\ncell population"</span>
    )+
    <span class="co"># Theme</span>
    <span class="no">theme_548</span> +
    <span class="co"># Axes</span>
    <span class="fu">theme</span>(
      <span class="kw">axis.ticks.x</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
      <span class="kw">axis.text.x</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">margin</span> <span class="kw">=</span> <span class="fu">margin</span>(<span class="kw">t</span> <span class="kw">=</span> <span class="fl">0</span>))
    ) +
    <span class="fu">geom_rangeframe</span>(<span class="kw">sides</span> <span class="kw">=</span> <span class="st">'l'</span>)
<span class="no">fig_E</span></pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
</div>
<div id="build-a-line-plot-with-error-bars-and-other-graphical-features-figure-3-panel-b" class="section level2">
<h2 class="hasAnchor">
<a href="#build-a-line-plot-with-error-bars-and-other-graphical-features-figure-3-panel-b" class="anchor"></a>Build a line plot with error bars and other graphical features (Figure 3 Panel B):</h2>
<p><strong>Visualize data:</strong></p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="fu">read_csv</span>(<span class="st">"Fig3B_data.csv"</span>)
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   .default = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; See spec(...) for full column specifications.</span>
<span class="co">#&gt; # A tibble: 239 x 23</span>
<span class="co">#&gt;    trial direction    speed  bin1  bin2  bin3  bin4  bin5  bin6  bin7  bin8</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1       135   1.90   12.0   4.00  4.00  0     4.00  0     0     0   </span>
<span class="co">#&gt;  2     2       NaN NaN       0     4.00  0     4.00  0     0     0     0   </span>
<span class="co">#&gt;  3     3       315  -0.696   0     4.00  0     0     0     0     4.00  0   </span>
<span class="co">#&gt;  4     4       NaN NaN       0     0     0     0     0     4.00  0     0   </span>
<span class="co">#&gt;  5     5       135  -0.0867  0     0     0     4.00  0     0     0     0   </span>
<span class="co">#&gt;  6     6       NaN NaN       0     0     0     0     0     0     0     0   </span>
<span class="co">#&gt;  7     7       135   0.821  16    24    16    28    36     8.00  8.00  8.00</span>
<span class="co">#&gt;  8     8       NaN NaN       4.00  0     0     0     0     0     0     0   </span>
<span class="co">#&gt;  9     9       315   1.63    0     0     0     0     0     0     0     0   </span>
<span class="co">#&gt; 10    10       NaN NaN       0     4.00 12     0     4.00  0     0     4.00</span>
<span class="co">#&gt; # … with 229 more rows, and 12 more variables: bin9 &lt;dbl&gt;, bin10 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   bin11 &lt;dbl&gt;, bin12 &lt;dbl&gt;, bin13 &lt;dbl&gt;, bin14 &lt;dbl&gt;, bin15 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   bin16 &lt;dbl&gt;, bin17 &lt;dbl&gt;, bin18 &lt;dbl&gt;, bin19 &lt;dbl&gt;, bin20 &lt;dbl&gt;</span></pre></body></html></div>
<p><strong>Gather all the bin data into one column:</strong></p>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="fu">read_csv</span>(<span class="st">"Fig3B_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">gather</span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">bin</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="no">count</span>, <span class="fu">starts_with</span>(<span class="st">"bin"</span>))
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   .default = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; See spec(...) for full column specifications.</span>
<span class="co">#&gt; # A tibble: 4,780 x 5</span>
<span class="co">#&gt;    trial direction    speed bin   count</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1       135   1.90   bin1  12.0 </span>
<span class="co">#&gt;  2     2       NaN NaN      bin1   0   </span>
<span class="co">#&gt;  3     3       315  -0.696  bin1   0   </span>
<span class="co">#&gt;  4     4       NaN NaN      bin1   0   </span>
<span class="co">#&gt;  5     5       135  -0.0867 bin1   0   </span>
<span class="co">#&gt;  6     6       NaN NaN      bin1   0   </span>
<span class="co">#&gt;  7     7       135   0.821  bin1  16   </span>
<span class="co">#&gt;  8     8       NaN NaN      bin1   4.00</span>
<span class="co">#&gt;  9     9       315   1.63   bin1   0   </span>
<span class="co">#&gt; 10    10       NaN NaN      bin1   0   </span>
<span class="co">#&gt; # … with 4,770 more rows</span></pre></body></html></div>
<p><strong>Group the data by trial, direction speed:</strong></p>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="fu">read_csv</span>(<span class="st">"Fig3B_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">gather</span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">bin</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="no">count</span>, <span class="fu">starts_with</span>(<span class="st">"bin"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">trial</span>, <span class="no">direction</span>, <span class="no">speed</span>)
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   .default = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; See spec(...) for full column specifications.</span>
<span class="co">#&gt; # A tibble: 4,780 x 5</span>
<span class="co">#&gt; # Groups:   trial, direction, speed [239]</span>
<span class="co">#&gt;    trial direction    speed bin   count</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1       135   1.90   bin1  12.0 </span>
<span class="co">#&gt;  2     2       NaN NaN      bin1   0   </span>
<span class="co">#&gt;  3     3       315  -0.696  bin1   0   </span>
<span class="co">#&gt;  4     4       NaN NaN      bin1   0   </span>
<span class="co">#&gt;  5     5       135  -0.0867 bin1   0   </span>
<span class="co">#&gt;  6     6       NaN NaN      bin1   0   </span>
<span class="co">#&gt;  7     7       135   0.821  bin1  16   </span>
<span class="co">#&gt;  8     8       NaN NaN      bin1   4.00</span>
<span class="co">#&gt;  9     9       315   1.63   bin1   0   </span>
<span class="co">#&gt; 10    10       NaN NaN      bin1   0   </span>
<span class="co">#&gt; # … with 4,770 more rows</span></pre></body></html></div>
<p><strong>Calculate firing rate for each trial:</strong></p>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="fu">read_csv</span>(<span class="st">"Fig3B_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">gather</span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">bin</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="no">count</span>, <span class="fu">starts_with</span>(<span class="st">"bin"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">trial</span>, <span class="no">direction</span>, <span class="no">speed</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(
    <span class="kw">raw_firing_rate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">count</span>)
  )
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   .default = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; See spec(...) for full column specifications.</span>
<span class="co">#&gt; `summarise()` regrouping output by 'trial', 'direction' (override with `.groups` argument)</span>
<span class="co">#&gt; # A tibble: 239 x 4</span>
<span class="co">#&gt; # Groups:   trial, direction [239]</span>
<span class="co">#&gt;    trial direction    speed raw_firing_rate</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1       135   1.90             2.00 </span>
<span class="co">#&gt;  2     2       NaN NaN                0.400</span>
<span class="co">#&gt;  3     3       315  -0.696            0.800</span>
<span class="co">#&gt;  4     4       NaN NaN                0.400</span>
<span class="co">#&gt;  5     5       135  -0.0867           0.600</span>
<span class="co">#&gt;  6     6       NaN NaN                0    </span>
<span class="co">#&gt;  7     7       135   0.821           11.4  </span>
<span class="co">#&gt;  8     8       NaN NaN                0.200</span>
<span class="co">#&gt;  9     9       315   1.63             0    </span>
<span class="co">#&gt; 10    10       NaN NaN                1.20 </span>
<span class="co">#&gt; # … with 229 more rows</span></pre></body></html></div>
<p><strong>Finally let’s ungroup and store this unnormalized data:</strong></p>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="no">data_B_raw</span> <span class="kw">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Fig3B_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">gather</span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">bin</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="no">count</span>, <span class="fu">starts_with</span>(<span class="st">"bin"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">trial</span>, <span class="no">direction</span>, <span class="no">speed</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(
    <span class="kw">raw_firing_rate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">count</span>)
  ) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>()
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   .default = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; See spec(...) for full column specifications.</span>
<span class="co">#&gt; `summarise()` regrouping output by 'trial', 'direction' (override with `.groups` argument)</span>
<span class="no">data_B_raw</span>
<span class="co">#&gt; # A tibble: 239 x 4</span>
<span class="co">#&gt;    trial direction    speed raw_firing_rate</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1       135   1.90             2.00 </span>
<span class="co">#&gt;  2     2       NaN NaN                0.400</span>
<span class="co">#&gt;  3     3       315  -0.696            0.800</span>
<span class="co">#&gt;  4     4       NaN NaN                0.400</span>
<span class="co">#&gt;  5     5       135  -0.0867           0.600</span>
<span class="co">#&gt;  6     6       NaN NaN                0    </span>
<span class="co">#&gt;  7     7       135   0.821           11.4  </span>
<span class="co">#&gt;  8     8       NaN NaN                0.200</span>
<span class="co">#&gt;  9     9       315   1.63             0    </span>
<span class="co">#&gt; 10    10       NaN NaN                1.20 </span>
<span class="co">#&gt; # … with 229 more rows</span></pre></body></html></div>
<p><strong>Now we need to normalize the data:</strong></p>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="co"># First calculate a baseline</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span>(<span class="no">data_B_raw</span>)
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;   trial direction    speed raw_firing_rate</span>
<span class="co">#&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1   234       NaN NaN                0.400</span>
<span class="co">#&gt; 2   235       315  -0.0867           4.00 </span>
<span class="co">#&gt; 3   236       NaN NaN                0    </span>
<span class="co">#&gt; 4   237       135  -0.696            0.600</span>
<span class="co">#&gt; 5   238       NaN NaN                0.600</span>
<span class="co">#&gt; 6   239       315   0.821            0.200</span>

<span class="no">data_B_raw</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">direction</span> <span class="kw">==</span> <span class="st">'NaN'</span>)
<span class="co">#&gt; # A tibble: 119 x 4</span>
<span class="co">#&gt;    trial direction speed raw_firing_rate</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt;  1     2       NaN   NaN           0.400</span>
<span class="co">#&gt;  2     4       NaN   NaN           0.400</span>
<span class="co">#&gt;  3     6       NaN   NaN           0    </span>
<span class="co">#&gt;  4     8       NaN   NaN           0.200</span>
<span class="co">#&gt;  5    10       NaN   NaN           1.20 </span>
<span class="co">#&gt;  6    12       NaN   NaN           0.600</span>
<span class="co">#&gt;  7    14       NaN   NaN           0.800</span>
<span class="co">#&gt;  8    16       NaN   NaN           0.6  </span>
<span class="co">#&gt;  9    18       NaN   NaN           0.200</span>
<span class="co">#&gt; 10    20       NaN   NaN           0.400</span>
<span class="co">#&gt; # … with 109 more rows</span>

<span class="no">data_B_raw</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">direction</span> <span class="kw">==</span> <span class="st">'NaN'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">pull</span>(<span class="no">raw_firing_rate</span>)
<span class="co">#&gt;   [1]  0.400010  0.400010  0.000000  0.200005  1.200015  0.600015  0.800020</span>
<span class="co">#&gt;   [8]  0.600000  0.200005  0.400010  0.200005  1.000020  4.600060  1.800045</span>
<span class="co">#&gt;  [15]  2.200045  0.000000 11.000040  1.200030  1.400035  0.400010  1.600010</span>
<span class="co">#&gt;  [22]  0.600030  0.000000  0.000000  0.000000  0.200005  0.000000  0.000000</span>
<span class="co">#&gt;  [29]  0.200005  0.400010  0.200005  0.000000  0.200005  0.200005  0.600015</span>
<span class="co">#&gt;  [36]  0.000000  0.000000  1.600035  3.600060  0.200005  0.200000  0.200005</span>
<span class="co">#&gt;  [43]  0.800020  0.000000  0.400010  0.200005  0.800020  0.800020  0.800020</span>
<span class="co">#&gt;  [50]  0.200005  0.200000  0.600015  0.200005  0.600015  0.600015  0.000000</span>
<span class="co">#&gt;  [57]  0.200005  0.000000  0.200005  0.000000  0.000000  0.000000  0.000000</span>
<span class="co">#&gt;  [64]  0.000000  0.200005  0.400005  1.400020  0.000000  0.000000  0.000000</span>
<span class="co">#&gt;  [71]  0.000000 12.800070  0.000000  0.000000  0.000000  0.000000  1.600070</span>
<span class="co">#&gt;  [78]  0.400010  4.200115  1.200015  0.000000  0.000000  0.000000  0.200005</span>
<span class="co">#&gt;  [85]  0.000000  0.400010  0.400010  0.400010  0.200005  1.400035  0.400010</span>
<span class="co">#&gt;  [92]  0.200005  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000</span>
<span class="co">#&gt;  [99]  4.600050  0.200005  0.000000  0.400010  1.800045  0.600015  0.200005</span>
<span class="co">#&gt; [106]  0.000000  0.200005  0.200005  0.000000  0.000000  0.200005  0.000000</span>
<span class="co">#&gt; [113]  0.000000  0.200005  0.000000  0.400005  0.400010  0.000000  0.600015</span>

<span class="no">baseline</span> <span class="kw">&lt;-</span> <span class="no">data_B_raw</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">direction</span> <span class="kw">==</span> <span class="st">'NaN'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">pull</span>(<span class="no">raw_firing_rate</span>) <span class="kw">%&gt;%</span>
  <span class="no">mean</span>
<span class="no">baseline</span>
<span class="co">#&gt; [1] 0.6806833</span>

<span class="co"># Use the baseline to normalize the data</span>
<span class="no">data_B_raw</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">direction</span> <span class="kw">!=</span> <span class="st">'NaN'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">norm_firing_rate</span> <span class="kw">=</span> <span class="no">raw_firing_rate</span> - <span class="no">baseline</span>,
    <span class="kw">norm_firing_rate</span> <span class="kw">=</span> <span class="no">norm_firing_rate</span> / <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">norm_firing_rate</span>))
  )
<span class="co">#&gt; # A tibble: 120 x 5</span>
<span class="co">#&gt;    trial direction   speed raw_firing_rate norm_firing_rate</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1       135  1.90             2.00           0.0676 </span>
<span class="co">#&gt;  2     3       315 -0.696            0.800          0.00611</span>
<span class="co">#&gt;  3     5       135 -0.0867           0.600         -0.00413</span>
<span class="co">#&gt;  4     7       135  0.821           11.4            0.549  </span>
<span class="co">#&gt;  5     9       315  1.63             0             -0.0349 </span>
<span class="co">#&gt;  6    11       135 -0.401            0.200         -0.0246 </span>
<span class="co">#&gt;  7    13       315  1.90             0             -0.0349 </span>
<span class="co">#&gt;  8    15       135  1.63            20.2            1      </span>
<span class="co">#&gt;  9    17       315 -0.0867           0.200         -0.0246 </span>
<span class="co">#&gt; 10    19       135  1.13            13.2            0.641  </span>
<span class="co">#&gt; # … with 110 more rows</span></pre></body></html></div>
<p><strong>Next let’s find the mean and SE of firing rate across like trials:</strong></p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">data_B_raw</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">direction</span> <span class="kw">!=</span> <span class="st">'NaN'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">norm_firing_rate</span> <span class="kw">=</span> <span class="no">raw_firing_rate</span> - <span class="no">baseline</span>,
    <span class="kw">norm_firing_rate</span> <span class="kw">=</span> <span class="no">norm_firing_rate</span> / <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">norm_firing_rate</span>))
  ) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">direction</span>, <span class="no">speed</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(
    <span class="kw">firing_rate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">norm_firing_rate</span>),
    <span class="kw">sem</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">norm_firing_rate</span>) / <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu">n</span>())
  )
<span class="co">#&gt; `summarise()` regrouping output by 'direction' (override with `.groups` argument)</span>
<span class="co">#&gt; # A tibble: 24 x 4</span>
<span class="co">#&gt; # Groups:   direction [2]</span>
<span class="co">#&gt;    direction   speed firing_rate     sem</span>
<span class="co">#&gt;        &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1       135 -0.696      -0.0185 0.00832</span>
<span class="co">#&gt;  2       135 -0.401      -0.0246 0.00561</span>
<span class="co">#&gt;  3       135 -0.0867     -0.0164 0.00753</span>
<span class="co">#&gt;  4       135  0.214      -0.0103 0.0132 </span>
<span class="co">#&gt;  5       135  0.524       0.0287 0.0252 </span>
<span class="co">#&gt;  6       135  0.821       0.148  0.101  </span>
<span class="co">#&gt;  7       135  1.13        0.412  0.0661 </span>
<span class="co">#&gt;  8       135  1.30        0.578  0.0902 </span>
<span class="co">#&gt;  9       135  1.43        0.654  0.0572 </span>
<span class="co">#&gt; 10       135  1.63        0.717  0.0812 </span>
<span class="co">#&gt; # … with 14 more rows</span></pre></body></html></div>
<p><strong>Finally ungroup the data and convert direction to a factor:</strong></p>
<div class="sourceCode" id="cb44"><html><body><pre class="r"><span class="no">data_B</span> <span class="kw">&lt;-</span> <span class="no">data_B_raw</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">direction</span> <span class="kw">!=</span> <span class="st">'NaN'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">norm_firing_rate</span> <span class="kw">=</span> <span class="no">raw_firing_rate</span> - <span class="no">baseline</span>,
    <span class="kw">norm_firing_rate</span> <span class="kw">=</span> <span class="no">norm_firing_rate</span> / <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">norm_firing_rate</span>))
  ) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">direction</span>, <span class="no">speed</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(
    <span class="kw">firing_rate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">norm_firing_rate</span>),
    <span class="kw">sem</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">norm_firing_rate</span>) / <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu">n</span>())
  ) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">direction</span> <span class="kw">=</span> <span class="fu">as_factor</span>(<span class="no">direction</span>))
<span class="co">#&gt; `summarise()` regrouping output by 'direction' (override with `.groups` argument)</span>
<span class="no">data_B</span>
<span class="co">#&gt; # A tibble: 24 x 4</span>
<span class="co">#&gt;    direction   speed firing_rate     sem</span>
<span class="co">#&gt;    &lt;fct&gt;       &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 135       -0.696      -0.0185 0.00832</span>
<span class="co">#&gt;  2 135       -0.401      -0.0246 0.00561</span>
<span class="co">#&gt;  3 135       -0.0867     -0.0164 0.00753</span>
<span class="co">#&gt;  4 135        0.214      -0.0103 0.0132 </span>
<span class="co">#&gt;  5 135        0.524       0.0287 0.0252 </span>
<span class="co">#&gt;  6 135        0.821       0.148  0.101  </span>
<span class="co">#&gt;  7 135        1.13        0.412  0.0661 </span>
<span class="co">#&gt;  8 135        1.30        0.578  0.0902 </span>
<span class="co">#&gt;  9 135        1.43        0.654  0.0572 </span>
<span class="co">#&gt; 10 135        1.63        0.717  0.0812 </span>
<span class="co">#&gt; # … with 14 more rows</span></pre></body></html></div>
<p><strong>Plot the data!</strong></p>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="no">data_B</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">firing_rate</span>)) +
    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>))</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-43-1.png" width="700"></p>
<p><strong>Add error bars and threshold line:</strong></p>
<div class="sourceCode" id="cb46"><html><body><pre class="r"><span class="no">data_B</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">firing_rate</span>)) +
    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="fu">geom_errorbar</span>(
      <span class="fu">aes</span>(
        <span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>,
        <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">firing_rate</span> - <span class="no">sem</span>,
        <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">firing_rate</span> + <span class="no">sem</span>
      ),
      <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0.02</span>
    ) +
    <span class="fu">geom_hline</span>(
      <span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0.8</span> * <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">data_B</span>$<span class="no">firing_rate</span>),
      <span class="kw">colour</span> <span class="kw">=</span> <span class="st">'grey70'</span>,
      <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">'dashed'</span>
    )</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-44-1.png" width="700"></p>
<p><strong>Add a line segment indicating points over threshold:</strong></p>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="no">data_B</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">firing_rate</span>)) +
    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="fu">geom_errorbar</span>(
      <span class="fu">aes</span>(
        <span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>,
        <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">firing_rate</span> - <span class="no">sem</span>,
        <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">firing_rate</span> + <span class="no">sem</span>
      ),
      <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0.02</span>
    ) +
    <span class="fu">geom_hline</span>(
      <span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0.8</span> * <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">data_B</span>$<span class="no">firing_rate</span>),
      <span class="kw">colour</span> <span class="kw">=</span> <span class="st">'grey70'</span>,
      <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">'dashed'</span>
    ) +
    <span class="fu">annotate</span>(
      <span class="kw">geom</span> <span class="kw">=</span> <span class="st">'segment'</span>,
      <span class="kw">x</span> <span class="kw">=</span> <span class="fl">1.3</span>,
      <span class="kw">xend</span> <span class="kw">=</span> <span class="fl">1.78</span>,
      <span class="kw">y</span> <span class="kw">=</span> <span class="fl">1.2</span>,
      <span class="kw">yend</span> <span class="kw">=</span> <span class="fl">1.2</span>,
      <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.7</span>,
      <span class="kw">arrow</span> <span class="kw">=</span> <span class="fu">arrow</span>(<span class="kw">ends</span> <span class="kw">=</span> <span class="st">'both'</span>, <span class="kw">length</span> <span class="kw">=</span> <span class="fu">unit</span>(<span class="fl">2</span>, <span class="st">"pt"</span>), <span class="kw">angle</span> <span class="kw">=</span> <span class="fl">90</span>)
    )</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-45-1.png" width="700"></p>
<p><strong>Set colours, shapes, labels, and themes:</strong></p>
<div class="sourceCode" id="cb48"><html><body><pre class="r"><span class="no">data_B</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">firing_rate</span>)) +
    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="fu">geom_errorbar</span>(
      <span class="fu">aes</span>(
        <span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>,
        <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">firing_rate</span> - <span class="no">sem</span>,
        <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">firing_rate</span> + <span class="no">sem</span>
      ),
      <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0.02</span>
    ) +
    <span class="fu">geom_hline</span>(
      <span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0.8</span> * <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">data_B</span>$<span class="no">firing_rate</span>),
      <span class="kw">colour</span> <span class="kw">=</span> <span class="st">'grey70'</span>,
      <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">'dashed'</span>
    ) +
    <span class="fu">annotate</span>(
      <span class="kw">geom</span> <span class="kw">=</span> <span class="st">'segment'</span>,
      <span class="kw">x</span> <span class="kw">=</span> <span class="fl">1.3</span>, <span class="kw">xend</span> <span class="kw">=</span> <span class="fl">1.78</span>,
      <span class="kw">y</span> <span class="kw">=</span> <span class="fl">1.2</span>, <span class="kw">yend</span> <span class="kw">=</span> <span class="fl">1.2</span>,
      <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.7</span>,
      <span class="kw">arrow</span> <span class="kw">=</span> <span class="fu">arrow</span>(<span class="kw">ends</span> <span class="kw">=</span> <span class="st">'both'</span>, <span class="kw">length</span> <span class="kw">=</span> <span class="fu">unit</span>(<span class="fl">2</span>, <span class="st">"pt"</span>), <span class="kw">angle</span> <span class="kw">=</span> <span class="fl">90</span>)
    ) +
    <span class="fu">scale_colour_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>, <span class="st">"grey50"</span>)) +
    <span class="fu">scale_shape_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>, <span class="fl">18</span>)) +
    <span class="fu">labs</span>(<span class="kw">y</span> <span class="kw">=</span> <span class="st">"Normalized\nfiring rate"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="st">""</span>) +
    <span class="no">theme_548</span></pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-46-1.png" width="700"></p>
<p><strong>Make the diamonds bigger, reorder layers to emphasize points, remove x axis title:</strong></p>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="no">data_B</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">firing_rate</span>)) +
    <span class="fu">geom_hline</span>(
      <span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0.8</span> * <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">data_B</span>$<span class="no">firing_rate</span>),
      <span class="kw">colour</span> <span class="kw">=</span> <span class="st">'grey70'</span>,
      <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">'dashed'</span>
    ) +
    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="fu">geom_errorbar</span>(
      <span class="fu">aes</span>(
        <span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>,
        <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">firing_rate</span> - <span class="no">sem</span>,
        <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">firing_rate</span> + <span class="no">sem</span>
      ),
      <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0.02</span>
    ) +
    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="no">direction</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="fu">annotate</span>(
      <span class="kw">geom</span> <span class="kw">=</span> <span class="st">'segment'</span>,
      <span class="kw">x</span> <span class="kw">=</span> <span class="fl">1.3</span>, <span class="kw">xend</span> <span class="kw">=</span> <span class="fl">1.78</span>,
      <span class="kw">y</span> <span class="kw">=</span> <span class="fl">1.2</span>, <span class="kw">yend</span> <span class="kw">=</span> <span class="fl">1.2</span>,
      <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.7</span>,
      <span class="kw">arrow</span> <span class="kw">=</span> <span class="fu">arrow</span>(<span class="kw">ends</span> <span class="kw">=</span> <span class="st">'both'</span>, <span class="kw">length</span> <span class="kw">=</span> <span class="fu">unit</span>(<span class="fl">2</span>, <span class="st">"pt"</span>), <span class="kw">angle</span> <span class="kw">=</span> <span class="fl">90</span>)
    ) +
    <span class="fu">scale_colour_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>, <span class="st">"grey50"</span>)) +
    <span class="fu">scale_shape_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>, <span class="fl">18</span>)) +
    <span class="fu">scale_size_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">3</span>)) +
    <span class="fu">labs</span>(<span class="kw">y</span> <span class="kw">=</span> <span class="st">"Normalized\nfiring rate"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="st">""</span>) +
    <span class="fu">theme</span>(<span class="kw">axis.title.x</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
    <span class="no">theme_548</span></pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-47-1.png" width="700"></p>
<p><strong>Add axis lines:</strong></p>
<div class="sourceCode" id="cb50"><html><body><pre class="r"><span class="no">data_B</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">firing_rate</span>)) +
    <span class="fu">geom_hline</span>(
      <span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0.8</span> * <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">data_B</span>$<span class="no">firing_rate</span>),
      <span class="kw">colour</span> <span class="kw">=</span> <span class="st">'grey70'</span>,
      <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">'dashed'</span>
    ) +
    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="fu">geom_errorbar</span>(
      <span class="fu">aes</span>(
        <span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>,
        <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">firing_rate</span> - <span class="no">sem</span>,
        <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">firing_rate</span> + <span class="no">sem</span>
      ),
      <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0.02</span>
    ) +
    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="no">direction</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="fu">annotate</span>(
      <span class="kw">geom</span> <span class="kw">=</span> <span class="st">'segment'</span>,
      <span class="kw">x</span> <span class="kw">=</span> <span class="fl">1.3</span>, <span class="kw">xend</span> <span class="kw">=</span> <span class="fl">1.78</span>,
      <span class="kw">y</span> <span class="kw">=</span> <span class="fl">1.2</span>, <span class="kw">yend</span> <span class="kw">=</span> <span class="fl">1.2</span>,
      <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.7</span>,
      <span class="kw">arrow</span> <span class="kw">=</span> <span class="fu">arrow</span>(<span class="kw">ends</span> <span class="kw">=</span> <span class="st">'both'</span>, <span class="kw">length</span> <span class="kw">=</span> <span class="fu">unit</span>(<span class="fl">2</span>, <span class="st">"pt"</span>), <span class="kw">angle</span> <span class="kw">=</span> <span class="fl">90</span>)
    ) +
    <span class="fu">scale_colour_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>, <span class="st">"grey50"</span>)) +
    <span class="fu">scale_shape_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>, <span class="fl">18</span>)) +
    <span class="fu">scale_size_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">3</span>)) +
    <span class="fu">labs</span>(<span class="kw">y</span> <span class="kw">=</span> <span class="st">"Normalized\nfiring rate"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="st">""</span>) +
    <span class="fu">theme</span>(<span class="kw">axis.title.x</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
    <span class="no">theme_548</span> +
    <span class="fu">geom_rangeframe</span>()</pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-48-1.png" width="700"></p>
<p><strong>Note the line lengths, y limits, and x breaks are all wrong</strong><br>
To fudge the lines, let’s make another dataset:</p>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="no">fudge_axis_BC</span> <span class="kw">&lt;-</span> <span class="fu">tibble</span>(<span class="kw">speed</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">0.5</span>,<span class="fl">2</span>), <span class="kw">firing_rate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1</span>,<span class="fl">2</span>))
<span class="no">fudge_axis_BC</span>
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   speed firing_rate</span>
<span class="co">#&gt;   &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1  -0.5          -1</span>
<span class="co">#&gt; 2   2             2</span>

<span class="no">fig_B</span> <span class="kw">&lt;-</span> <span class="no">data_B</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">firing_rate</span>)) +
    <span class="co"># Plot data and threshold</span>
    <span class="fu">geom_hline</span>(
      <span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0.8</span> * <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">data_B</span>$<span class="no">firing_rate</span>),
      <span class="kw">colour</span> <span class="kw">=</span> <span class="st">'grey70'</span>,
      <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">'dashed'</span>
    ) +
    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="fu">geom_errorbar</span>(
      <span class="fu">aes</span>(
        <span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>,
        <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">firing_rate</span> - <span class="no">sem</span>,
        <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">firing_rate</span> + <span class="no">sem</span>
      ),
      <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0.02</span>
    ) +
    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="no">direction</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="co"># Annotate points over threshold</span>
    <span class="fu">annotate</span>(
      <span class="kw">geom</span> <span class="kw">=</span> <span class="st">'segment'</span>,
      <span class="kw">x</span> <span class="kw">=</span> <span class="fl">1.3</span>, <span class="kw">xend</span> <span class="kw">=</span> <span class="fl">1.78</span>,
      <span class="kw">y</span> <span class="kw">=</span> <span class="fl">1.2</span>, <span class="kw">yend</span> <span class="kw">=</span> <span class="fl">1.2</span>,
      <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.7</span>,
      <span class="kw">arrow</span> <span class="kw">=</span> <span class="fu">arrow</span>(<span class="kw">ends</span> <span class="kw">=</span> <span class="st">'both'</span>, <span class="kw">length</span> <span class="kw">=</span> <span class="fu">unit</span>(<span class="fl">2</span>, <span class="st">"pt"</span>), <span class="kw">angle</span> <span class="kw">=</span> <span class="fl">90</span>)
    ) +
    <span class="co"># Select colours and shapes</span>
    <span class="fu">scale_colour_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>, <span class="st">"grey50"</span>)) +
    <span class="fu">scale_shape_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>, <span class="fl">18</span>)) +
    <span class="fu">scale_size_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">3</span>)) +
    <span class="co"># Text</span>
    <span class="fu">labs</span>(<span class="kw">y</span> <span class="kw">=</span> <span class="st">"Normalized\nfiring rate"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="st">""</span>) +
    <span class="co"># Theme</span>
    <span class="no">theme_548</span> +
    <span class="co"># Axes</span>
    <span class="fu">geom_rangeframe</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">fudge_axis_BC</span>) +
    <span class="fu">lims</span>(<span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1</span>,<span class="fl">2</span>)) +
    <span class="fu">scale_x_continuous</span>(<span class="kw">breaks</span> <span class="kw">=</span> -<span class="fl">1</span>:<span class="fl">4</span> / <span class="fl">2</span>)
<span class="no">fig_B</span></pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-49-1.png" width="700"></p>
</div>
<div id="build-another-grouped-barplot-figure-3-panel-f" class="section level2">
<h2 class="hasAnchor">
<a href="#build-another-grouped-barplot-figure-3-panel-f" class="anchor"></a>Build another grouped barplot (Figure 3 Panel F):</h2>
<p><strong>Visualize data:</strong></p>
<div class="sourceCode" id="cb52"><html><body><pre class="r"><span class="fu">read_csv</span>(<span class="st">"./Fig3F_data.csv"</span>)
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   .default = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; See spec(...) for full column specifications.</span>
<span class="co">#&gt; # A tibble: 240 x 33</span>
<span class="co">#&gt;     bird   trk  site  cell pd.sum species test.dir1 dir1.area test.dir2</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1   194     1  3007     1   11.1       2         0      25.1       180</span>
<span class="co">#&gt;  2   194     1  3007     2  343.        2         0      41.4       180</span>
<span class="co">#&gt;  3   194     1  3062     1  298.        2        NA      NA          NA</span>
<span class="co">#&gt;  4   194     1  3062     2  358.        2         0      46.9       180</span>
<span class="co">#&gt;  5   194     1  3062     3  287.        2        NA      NA          NA</span>
<span class="co">#&gt;  6   194     3  3459     3  188.        2        NA      NA          NA</span>
<span class="co">#&gt;  7   194     5  3516     1  117.        2       135      20.9       315</span>
<span class="co">#&gt;  8   194     5  3516     2  176.        2       135      20.2       315</span>
<span class="co">#&gt;  9   194     5  3516     3  192.        2        NA      NA          NA</span>
<span class="co">#&gt; 10   194     5  3516     4  155.        2        NA      NA          NA</span>
<span class="co">#&gt; # … with 230 more rows, and 24 more variables: dir2.area &lt;dbl&gt;,</span>
<span class="co">#&gt; #   pref.speed &lt;dbl&gt;, sp80.1 &lt;dbl&gt;, sp80.2 &lt;dbl&gt;, sp80.3 &lt;dbl&gt;, sp80.4 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   sp80.5 &lt;dbl&gt;, sp80.6 &lt;dbl&gt;, sp80.7 &lt;dbl&gt;, sp80.8 &lt;dbl&gt;, sp80.9 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   sp80.10 &lt;dbl&gt;, sp80.11 &lt;dbl&gt;, sp80.12 &lt;dbl&gt;, tune50 &lt;dbl&gt;, tune55 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   tune60 &lt;dbl&gt;, tune65 &lt;dbl&gt;, tune70 &lt;dbl&gt;, tune75 &lt;dbl&gt;, tune80 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   tune85 &lt;dbl&gt;, tune90 &lt;dbl&gt;, tune95 &lt;dbl&gt;</span>
<span class="no">speeds_F</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.24</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">8</span>,<span class="fl">16</span>,<span class="fl">24</span>,<span class="fl">32</span>,<span class="fl">48</span>,<span class="fl">64</span>,<span class="fl">80</span>)</pre></body></html></div>
<p><strong>Remove any rows without data (dir1.area is NA):</strong></p>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="fu">read_csv</span>(<span class="st">"./Fig3F_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">dir1.area</span>))
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   .default = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; See spec(...) for full column specifications.</span>
<span class="co">#&gt; # A tibble: 163 x 33</span>
<span class="co">#&gt;     bird   trk  site  cell pd.sum species test.dir1 dir1.area test.dir2</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1   194     1  3007     1   11.1       2         0     25.1        180</span>
<span class="co">#&gt;  2   194     1  3007     2  343.        2         0     41.4        180</span>
<span class="co">#&gt;  3   194     1  3062     2  358.        2         0     46.9        180</span>
<span class="co">#&gt;  4   194     5  3516     1  117.        2       135     20.9        315</span>
<span class="co">#&gt;  5   194     5  3516     2  176.        2       135     20.2        315</span>
<span class="co">#&gt;  6   198     3  2990     1  320.        2       315    -12.9        135</span>
<span class="co">#&gt;  7   198     3  2990     2  340.        2       315     30.4        135</span>
<span class="co">#&gt;  8   198     5  3345     2  147.        2       135     -2.81       315</span>
<span class="co">#&gt;  9   198     5  3345     3  141.        2       135    -22.7        315</span>
<span class="co">#&gt; 10   199     1  2383     1   92.4       2        90      1.67       270</span>
<span class="co">#&gt; # … with 153 more rows, and 24 more variables: dir2.area &lt;dbl&gt;,</span>
<span class="co">#&gt; #   pref.speed &lt;dbl&gt;, sp80.1 &lt;dbl&gt;, sp80.2 &lt;dbl&gt;, sp80.3 &lt;dbl&gt;, sp80.4 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   sp80.5 &lt;dbl&gt;, sp80.6 &lt;dbl&gt;, sp80.7 &lt;dbl&gt;, sp80.8 &lt;dbl&gt;, sp80.9 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   sp80.10 &lt;dbl&gt;, sp80.11 &lt;dbl&gt;, sp80.12 &lt;dbl&gt;, tune50 &lt;dbl&gt;, tune55 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   tune60 &lt;dbl&gt;, tune65 &lt;dbl&gt;, tune70 &lt;dbl&gt;, tune75 &lt;dbl&gt;, tune80 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   tune85 &lt;dbl&gt;, tune90 &lt;dbl&gt;, tune95 &lt;dbl&gt;</span></pre></body></html></div>
<p><strong>Remove unnecessary columns:</strong></p>
<div class="sourceCode" id="cb54"><html><body><pre class="r"><span class="fu">read_csv</span>(<span class="st">"./Fig3F_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">dir1.area</span>))  <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"sp"</span>))
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   .default = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; See spec(...) for full column specifications.</span>
<span class="co">#&gt; # A tibble: 163 x 13</span>
<span class="co">#&gt;    species sp80.1 sp80.2 sp80.3 sp80.4 sp80.5 sp80.6 sp80.7 sp80.8 sp80.9</span>
<span class="co">#&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1       2      0      0      0      0      0      0      0      0      0</span>
<span class="co">#&gt;  2       2      0      0      0      0      0      0      0      0      1</span>
<span class="co">#&gt;  3       2      0      0      0      0      0      0      0      0      1</span>
<span class="co">#&gt;  4       2      0      0      0      0      0      0      0      0      0</span>
<span class="co">#&gt;  5       2      0      0      0      0      1      0      0      0      0</span>
<span class="co">#&gt;  6       2      0      0      0      1      0      0      0      0      0</span>
<span class="co">#&gt;  7       2      0      0      0      0      0      0      0      0      0</span>
<span class="co">#&gt;  8       2      0      0      0      0      0      0      0      0      0</span>
<span class="co">#&gt;  9       2      1      0      0      0      0      0      0      0      0</span>
<span class="co">#&gt; 10       2      0      1      0      0      0      0      0      0      0</span>
<span class="co">#&gt; # … with 153 more rows, and 3 more variables: sp80.10 &lt;dbl&gt;, sp80.11 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   sp80.12 &lt;dbl&gt;</span></pre></body></html></div>
<p><strong>Rename columns using speeds_F, change species to words:</strong></p>
<div class="sourceCode" id="cb55"><html><body><pre class="r"><span class="fu">read_csv</span>(<span class="st">"./Fig3F_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">dir1.area</span>))  <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"sp"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">rename_all</span>(~<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"species"</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">speeds_F</span>))) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">species</span> <span class="kw">=</span> <span class="fu">case_when</span>(
      <span class="no">species</span> <span class="kw">==</span> <span class="fl">1</span> ~ <span class="st">"zb"</span>,
      <span class="no">species</span> <span class="kw">==</span> <span class="fl">2</span> ~ <span class="st">"hb"</span>
    )
  )
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   .default = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; See spec(...) for full column specifications.</span>
<span class="co">#&gt; # A tibble: 163 x 13</span>
<span class="co">#&gt;    species `0.24` `0.5`   `1`   `2`   `4`   `8`  `16`  `24`  `32`  `48`  `64`</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 hb           0     0     0     0     0     0     0     0     0     1     0</span>
<span class="co">#&gt;  2 hb           0     0     0     0     0     0     0     0     1     1     1</span>
<span class="co">#&gt;  3 hb           0     0     0     0     0     0     0     0     1     0     1</span>
<span class="co">#&gt;  4 hb           0     0     0     0     0     0     0     0     0     1     1</span>
<span class="co">#&gt;  5 hb           0     0     0     0     1     0     0     0     0     1     0</span>
<span class="co">#&gt;  6 hb           0     0     0     1     0     0     0     0     0     0     0</span>
<span class="co">#&gt;  7 hb           0     0     0     0     0     0     0     0     0     0     1</span>
<span class="co">#&gt;  8 hb           0     0     0     0     0     0     0     0     0     0     1</span>
<span class="co">#&gt;  9 hb           1     0     0     0     0     0     0     0     0     0     0</span>
<span class="co">#&gt; 10 hb           0     1     0     0     0     0     0     0     0     0     0</span>
<span class="co">#&gt; # … with 153 more rows, and 1 more variable: `80` &lt;dbl&gt;</span></pre></body></html></div>
<p><strong>Reshape data for plotting:</strong></p>
<div class="sourceCode" id="cb56"><html><body><pre class="r"><span class="fu">read_csv</span>(<span class="st">"./Fig3F_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">dir1.area</span>))  <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"sp"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">rename_all</span>(~<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"species"</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">speeds_F</span>))) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">species</span> <span class="kw">=</span> <span class="fu">case_when</span>(
      <span class="no">species</span> <span class="kw">==</span> <span class="fl">1</span> ~ <span class="st">"zb"</span>,
      <span class="no">species</span> <span class="kw">==</span> <span class="fl">2</span> ~ <span class="st">"hb"</span>
    )
  ) <span class="kw">%&gt;%</span>
  <span class="fu">gather</span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="no">prop</span>, -<span class="no">species</span>)
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   .default = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; See spec(...) for full column specifications.</span>
<span class="co">#&gt; # A tibble: 1,956 x 3</span>
<span class="co">#&gt;    species speed  prop</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 hb      0.24      0</span>
<span class="co">#&gt;  2 hb      0.24      0</span>
<span class="co">#&gt;  3 hb      0.24      0</span>
<span class="co">#&gt;  4 hb      0.24      0</span>
<span class="co">#&gt;  5 hb      0.24      0</span>
<span class="co">#&gt;  6 hb      0.24      0</span>
<span class="co">#&gt;  7 hb      0.24      0</span>
<span class="co">#&gt;  8 hb      0.24      0</span>
<span class="co">#&gt;  9 hb      0.24      1</span>
<span class="co">#&gt; 10 hb      0.24      0</span>
<span class="co">#&gt; # … with 1,946 more rows</span></pre></body></html></div>
<p><strong>Summarize proporions by species and speed:</strong></p>
<div class="sourceCode" id="cb57"><html><body><pre class="r"><span class="fu">read_csv</span>(<span class="st">"./Fig3F_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">dir1.area</span>))  <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"sp"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">rename_all</span>(~<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"species"</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">speeds_F</span>))) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">species</span> <span class="kw">=</span> <span class="fu">case_when</span>(
      <span class="no">species</span> <span class="kw">==</span> <span class="fl">1</span> ~ <span class="st">"zb"</span>,
      <span class="no">species</span> <span class="kw">==</span> <span class="fl">2</span> ~ <span class="st">"hb"</span>
    )
  ) <span class="kw">%&gt;%</span>
  <span class="fu">gather</span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="no">prop</span>, -<span class="no">species</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">species</span>, <span class="no">speed</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">prop</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">prop</span>)) <span class="kw">%&gt;%</span>
  <span class="no">ungroup</span>
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   .default = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; See spec(...) for full column specifications.</span>
<span class="co">#&gt; `summarise()` regrouping output by 'species' (override with `.groups` argument)</span>
<span class="co">#&gt; # A tibble: 24 x 3</span>
<span class="co">#&gt;    species speed   prop</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 hb      0.24  0.0357</span>
<span class="co">#&gt;  2 hb      0.5   0.0179</span>
<span class="co">#&gt;  3 hb      1     0     </span>
<span class="co">#&gt;  4 hb      16    0.143 </span>
<span class="co">#&gt;  5 hb      2     0.125 </span>
<span class="co">#&gt;  6 hb      24    0.232 </span>
<span class="co">#&gt;  7 hb      32    0.339 </span>
<span class="co">#&gt;  8 hb      4     0.0357</span>
<span class="co">#&gt;  9 hb      48    0.446 </span>
<span class="co">#&gt; 10 hb      64    0.5   </span>
<span class="co">#&gt; # … with 14 more rows</span></pre></body></html></div>
<p><strong>Finally fix the factor levels as before:</strong></p>
<div class="sourceCode" id="cb58"><html><body><pre class="r"><span class="no">data_F</span> <span class="kw">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./Fig3F_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">dir1.area</span>))  <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"sp"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">rename_all</span>(~<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"species"</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">speeds_F</span>))) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">species</span> <span class="kw">=</span> <span class="fu">case_when</span>(
      <span class="no">species</span> <span class="kw">==</span> <span class="fl">1</span> ~ <span class="st">"zb"</span>,
      <span class="no">species</span> <span class="kw">==</span> <span class="fl">2</span> ~ <span class="st">"hb"</span>
    )
  ) <span class="kw">%&gt;%</span>
  <span class="fu">gather</span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="no">prop</span>, -<span class="no">species</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">species</span>, <span class="no">speed</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">prop</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">prop</span>)) <span class="kw">%&gt;%</span>
  <span class="no">ungroup</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">species</span> <span class="kw">=</span> <span class="fu">fct_relevel</span>(<span class="no">species</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'hb'</span>, <span class="st">'zb'</span>)),
    <span class="kw">speed</span> <span class="kw">=</span> <span class="fu">as_factor</span>(<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">speed</span>))
  )
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   .default = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; See spec(...) for full column specifications.</span>
<span class="co">#&gt; `summarise()` regrouping output by 'species' (override with `.groups` argument)</span>
<span class="no">data_F</span>
<span class="co">#&gt; # A tibble: 24 x 3</span>
<span class="co">#&gt;    species speed   prop</span>
<span class="co">#&gt;    &lt;fct&gt;   &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 hb      0.24  0.0357</span>
<span class="co">#&gt;  2 hb      0.5   0.0179</span>
<span class="co">#&gt;  3 hb      1     0     </span>
<span class="co">#&gt;  4 hb      16    0.143 </span>
<span class="co">#&gt;  5 hb      2     0.125 </span>
<span class="co">#&gt;  6 hb      24    0.232 </span>
<span class="co">#&gt;  7 hb      32    0.339 </span>
<span class="co">#&gt;  8 hb      4     0.0357</span>
<span class="co">#&gt;  9 hb      48    0.446 </span>
<span class="co">#&gt; 10 hb      64    0.5   </span>
<span class="co">#&gt; # … with 14 more rows</span></pre></body></html></div>
<p><strong>Plot data as before:</strong></p>
<div class="sourceCode" id="cb59"><html><body><pre class="r"><span class="no">fig_F</span> <span class="kw">&lt;-</span> <span class="no">data_F</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">prop</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">species</span>)) +
    <span class="co"># Plot data</span>
    <span class="fu">geom_col</span>(
      <span class="kw">position</span> <span class="kw">=</span> <span class="fu">position_dodge</span>(<span class="fl">0.75</span>),
      <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0.75</span>,
      <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.2</span>,
      <span class="kw">colour</span> <span class="kw">=</span> <span class="st">"black"</span>
    ) +
    <span class="co"># Pick colours</span>
    <span class="fu">scale_fill_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">col_hb</span>, <span class="no">col_zb</span>)) +
    <span class="co"># Text</span>
    <span class="fu">labs</span>(
      <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Speed bins (degrees/s)"</span>,
      <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Proportion of LM\ncell population"</span>
    ) +
    <span class="co"># Theme</span>
    <span class="no">theme_548</span> +
    <span class="co"># Axes</span>
    <span class="fu">theme</span>(
      <span class="kw">axis.ticks.x</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
      <span class="kw">axis.text.x</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">margin</span> <span class="kw">=</span> <span class="fu">margin</span>(<span class="kw">t</span> <span class="kw">=</span> <span class="fl">0</span>))
    ) +
    <span class="fu">geom_rangeframe</span>(<span class="kw">sides</span> <span class="kw">=</span> <span class="st">'l'</span>)
<span class="no">fig_F</span></pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-57-1.png" width="700"></p>
</div>
<div id="build-another-line-plot-figure-3-panel-c" class="section level2">
<h2 class="hasAnchor">
<a href="#build-another-line-plot-figure-3-panel-c" class="anchor"></a>Build another line plot (Figure 3 Panel C):</h2>
<p><strong>Reorganize raw data:</strong></p>
<div class="sourceCode" id="cb60"><html><body><pre class="r"><span class="no">data_C_raw</span> <span class="kw">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Fig3C_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">gather</span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">bin</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="no">count</span>, <span class="fu">starts_with</span>(<span class="st">"bin"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">trial</span>, <span class="no">direction</span>, <span class="no">speed</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(
    <span class="kw">raw_firing_rate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">count</span>)
  ) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>()
<span class="co">#&gt; Parsed with column specification:</span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   .default = col_double()</span>
<span class="co">#&gt; )</span>
<span class="co">#&gt; See spec(...) for full column specifications.</span>
<span class="co">#&gt; `summarise()` regrouping output by 'trial', 'direction' (override with `.groups` argument)</span>
<span class="no">data_C_raw</span>
<span class="co">#&gt; # A tibble: 239 x 4</span>
<span class="co">#&gt;    trial direction   speed raw_firing_rate</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1       180   0.821            7.99</span>
<span class="co">#&gt;  2     2       NaN NaN                5.20</span>
<span class="co">#&gt;  3     3         0   1.30            24.8 </span>
<span class="co">#&gt;  4     4       NaN NaN                2.80</span>
<span class="co">#&gt;  5     5       180   1.77             3.00</span>
<span class="co">#&gt;  6     6       NaN NaN                4.00</span>
<span class="co">#&gt;  7     7         0   0.214           14.8 </span>
<span class="co">#&gt;  8     8       NaN NaN                2.80</span>
<span class="co">#&gt;  9     9       180   1.63             3.00</span>
<span class="co">#&gt; 10    10       NaN NaN                4.60</span>
<span class="co">#&gt; # … with 229 more rows</span></pre></body></html></div>
<p><strong>Calculate baseline:</strong></p>
<div class="sourceCode" id="cb61"><html><body><pre class="r"><span class="no">baseline</span> <span class="kw">&lt;-</span> <span class="no">data_C_raw</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">direction</span> <span class="kw">==</span> <span class="st">'NaN'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">pull</span>(<span class="no">raw_firing_rate</span>) <span class="kw">%&gt;%</span>
  <span class="no">mean</span>
<span class="no">baseline</span>
<span class="co">#&gt; [1] 3.852074</span></pre></body></html></div>
<p><strong>Normalize data and calculate mean, SE:</strong></p>
<div class="sourceCode" id="cb62"><html><body><pre class="r"><span class="no">data_C</span> <span class="kw">&lt;-</span> <span class="no">data_C_raw</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">direction</span> <span class="kw">!=</span> <span class="st">'NaN'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">norm_firing_rate</span> <span class="kw">=</span> <span class="no">raw_firing_rate</span> - <span class="no">baseline</span>,
    <span class="kw">norm_firing_rate</span> <span class="kw">=</span> <span class="no">norm_firing_rate</span> / <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">norm_firing_rate</span>))
  ) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">direction</span>, <span class="no">speed</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(
    <span class="kw">firing_rate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">norm_firing_rate</span>),
    <span class="kw">sem</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">norm_firing_rate</span>) / <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu">n</span>())
  ) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">direction</span> <span class="kw">=</span> <span class="fu">as_factor</span>(<span class="no">direction</span>))
<span class="co">#&gt; `summarise()` regrouping output by 'direction' (override with `.groups` argument)</span>
<span class="no">data_C</span>
<span class="co">#&gt; # A tibble: 24 x 4</span>
<span class="co">#&gt;    direction   speed firing_rate     sem</span>
<span class="co">#&gt;    &lt;fct&gt;       &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 0         -0.696      -0.0109 0.0164 </span>
<span class="co">#&gt;  2 0         -0.401       0.0133 0.00324</span>
<span class="co">#&gt;  3 0         -0.0867      0.138  0.0561 </span>
<span class="co">#&gt;  4 0          0.214       0.475  0.100  </span>
<span class="co">#&gt;  5 0          0.524       0.734  0.0500 </span>
<span class="co">#&gt;  6 0          0.821       0.872  0.0443 </span>
<span class="co">#&gt;  7 0          1.13        0.810  0.0794 </span>
<span class="co">#&gt;  8 0          1.30        0.746  0.0507 </span>
<span class="co">#&gt;  9 0          1.43        0.811  0.0452 </span>
<span class="co">#&gt; 10 0          1.63        0.772  0.0796 </span>
<span class="co">#&gt; # … with 14 more rows</span></pre></body></html></div>
<p><strong>Plot data:</strong></p>
<div class="sourceCode" id="cb63"><html><body><pre class="r"><span class="no">fig_C</span> <span class="kw">&lt;-</span> <span class="no">data_C</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">speed</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">firing_rate</span>)) +
    <span class="co"># Plot data and threshold</span>
    <span class="fu">geom_hline</span>(
      <span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0.8</span> * <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">data_C</span>$<span class="no">firing_rate</span>),
      <span class="kw">colour</span> <span class="kw">=</span> <span class="st">'grey70'</span>, <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">'dashed'</span>
    ) +
    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="fu">geom_errorbar</span>(
      <span class="fu">aes</span>(
        <span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>,
        <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">firing_rate</span> - <span class="no">sem</span>,
        <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">firing_rate</span> + <span class="no">sem</span>
      ),
      <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0.02</span>
    ) +
    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">direction</span>,
                   <span class="kw">shape</span> <span class="kw">=</span> <span class="no">direction</span>,
                   <span class="kw">size</span> <span class="kw">=</span> <span class="no">direction</span>)) +
    <span class="co"># Annotate points over threshold</span>
    <span class="fu">annotate</span>(
      <span class="kw">geom</span> <span class="kw">=</span> <span class="st">"segment"</span>,
      <span class="kw">x</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">xend</span> <span class="kw">=</span> <span class="fl">1.9</span>,
      <span class="kw">y</span> <span class="kw">=</span> <span class="fl">1.2</span>, <span class="kw">yend</span> <span class="kw">=</span> <span class="fl">1.2</span>,
      <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.7</span>,
      <span class="kw">arrow</span> <span class="kw">=</span> <span class="fu">arrow</span>(<span class="kw">ends</span> <span class="kw">=</span> <span class="st">'both'</span>, <span class="kw">length</span> <span class="kw">=</span> <span class="fu">unit</span>(<span class="fl">2</span>, <span class="st">"pt"</span>), <span class="kw">angle</span> <span class="kw">=</span> <span class="fl">90</span>)
    ) +
    <span class="co"># Select colours and shapes</span>
    <span class="fu">scale_colour_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>, <span class="st">"grey50"</span>)) +
    <span class="fu">scale_shape_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>, <span class="fl">18</span>)) +
    <span class="fu">scale_size_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">3</span>)) +
    <span class="co"># Text</span>
    <span class="fu">labs</span>(<span class="kw">y</span> <span class="kw">=</span> <span class="st">"Normalized\nfiring rate"</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="st">"log(degrees/s)"</span>) +
    <span class="co">#theme(axis.title.x = element_blank()) +</span>
    <span class="co"># Theme</span>
    <span class="no">theme_548</span> +
    <span class="co"># Axes</span>
    <span class="fu">geom_rangeframe</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">fudge_axis_BC</span>) +
    <span class="fu">lims</span>(<span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1</span>,<span class="fl">2</span>)) +
    <span class="fu">scale_x_continuous</span>(<span class="kw">breaks</span> <span class="kw">=</span> -<span class="fl">1</span>:<span class="fl">4</span> / <span class="fl">2</span>)
<span class="no">fig_C</span></pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/unnamed-chunk-61-1.png" width="700"></p>
</div>
<div id="build-a-connected-line-plot-figure-3-panel-a" class="section level2">
<h2 class="hasAnchor">
<a href="#build-a-connected-line-plot-figure-3-panel-a" class="anchor"></a>Build a connected-line plot (Figure 3 Panel A):</h2>
<p>Panel A is a bit complicated, so we’ll just provide the full code here</p>
<div class="sourceCode" id="cb64"><html><body><pre class="r"><span class="co"># First, import data</span>
<span class="no">fig_A</span> <span class="kw">&lt;-</span>
  <span class="fu">read_csv</span>(<span class="st">"./Fig3A_data.csv"</span>) <span class="kw">%&gt;%</span>
  <span class="co"># Now take every nth data point (produces plot faster)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="fu">row_number</span>() <span class="kw">%%</span> <span class="fl">5</span> <span class="kw">==</span> <span class="fl">0</span>) <span class="kw">%&gt;%</span>
  <span class="co"># Clean outliers</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">spike</span>) <span class="kw">&lt;</span> <span class="fl">7</span> * <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">spike</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="no">time</span>, <span class="no">spike</span>)) +
    <span class="fu">geom_path</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.1</span>) +
    <span class="fu">theme_void</span>() +
    <span class="co"># Y-axis vertical scale</span>
    <span class="fu">annotate</span>(<span class="kw">geom</span> <span class="kw">=</span> <span class="st">"segment"</span>,
             <span class="kw">y</span> <span class="kw">=</span> <span class="fl">0.00278</span> - <span class="fl">0.01</span>, <span class="kw">yend</span> <span class="kw">=</span> <span class="fl">0.00278</span> + <span class="fl">0.01</span>,
             <span class="kw">x</span> <span class="kw">=</span> -<span class="fl">1.5</span>, <span class="kw">xend</span> <span class="kw">=</span> -<span class="fl">1.5</span>,
             <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">1.2</span>) +
    <span class="co"># Y-axis scale label</span>
    <span class="fu">annotate</span>(<span class="kw">geom</span> <span class="kw">=</span> <span class="st">"text"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="fl">0.00278</span>, <span class="kw">x</span> <span class="kw">=</span> -<span class="fl">3</span>,
             <span class="kw">label</span> <span class="kw">=</span> <span class="st">"0.2 mV"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">angle</span> <span class="kw">=</span> <span class="fl">90</span>) +
    <span class="co"># X-axis scale bar</span>
    <span class="fu">annotate</span>(<span class="kw">geom</span> <span class="kw">=</span> <span class="st">"segment"</span>,
             <span class="kw">y</span> <span class="kw">=</span> -<span class="fl">0.035</span>, <span class="kw">yend</span> <span class="kw">=</span> -<span class="fl">0.035</span>,
             <span class="kw">x</span> <span class="kw">=</span> <span class="fl">70</span> + <span class="fl">1.5</span>, <span class="kw">xend</span> <span class="kw">=</span> <span class="fl">75</span> + <span class="fl">1.5</span>,
             <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">1.2</span>) +
    <span class="co"># X-axis scale label</span>
    <span class="fu">annotate</span>(<span class="kw">geom</span> <span class="kw">=</span> <span class="st">"text"</span>, <span class="kw">y</span> <span class="kw">=</span> -<span class="fl">0.04</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="fl">74</span>,
             <span class="kw">label</span> <span class="kw">=</span> <span class="st">"5s"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">5</span>) +
    <span class="co"># Large ticks</span>
    <span class="fu">annotate</span>(<span class="kw">geom</span> <span class="kw">=</span> <span class="st">"segment"</span>,
             <span class="kw">y</span> <span class="kw">=</span> -<span class="fl">0.03</span>, <span class="kw">yend</span> <span class="kw">=</span> -<span class="fl">0.025</span>,
             <span class="kw">x</span> <span class="kw">=</span> <span class="fl">1.5</span> + <span class="fl">1</span>:<span class="fl">15</span> * <span class="fl">5</span>, <span class="kw">xend</span> <span class="kw">=</span> <span class="fl">1.5</span> + <span class="fl">1</span>:<span class="fl">15</span> * <span class="fl">5</span>,
             <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">1</span>) +
    <span class="co"># Small ticks within large ticks</span>
    <span class="fu">annotate</span>(<span class="kw">geom</span> <span class="kw">=</span> <span class="st">"segment"</span>,
             <span class="kw">y</span> <span class="kw">=</span> -<span class="fl">0.027</span>, <span class="kw">yend</span> <span class="kw">=</span> -<span class="fl">0.028</span>,
             <span class="kw">x</span> <span class="kw">=</span> <span class="fl">1.5</span> + <span class="fl">1</span>:<span class="fl">79</span>, <span class="kw">xend</span> <span class="kw">=</span> <span class="fl">1.5</span> + <span class="fl">1</span>:<span class="fl">79</span>,
             <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">0.8</span>) +
    <span class="co"># Arrows</span>
    <span class="fu">annotate</span>(
      <span class="kw">geom</span> <span class="kw">=</span> <span class="st">"segment"</span>,
      <span class="kw">y</span> <span class="kw">=</span> -<span class="fl">0.0275</span>,
      <span class="kw">yend</span> <span class="kw">=</span> -<span class="fl">0.0275</span>,
      <span class="kw">x</span> <span class="kw">=</span> -<span class="fl">10</span> + <span class="fl">2.5</span> + <span class="fl">1</span>:<span class="fl">8</span> * <span class="fl">10</span>,
      <span class="kw">xend</span> <span class="kw">=</span> -<span class="fl">10</span> + <span class="fl">5.5</span> + <span class="fl">1</span>:<span class="fl">8</span> * <span class="fl">10</span>,
      <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">1.2</span>,
      <span class="kw">arrow</span> <span class="kw">=</span> <span class="fu">arrow</span>(
        <span class="co"># Control the direction of each arrow. first = left; last = right</span>
        <span class="kw">ends</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"first"</span>, <span class="st">"last"</span>, <span class="st">"last"</span>, <span class="st">"last"</span>,
                 <span class="st">"first"</span>, <span class="st">"first"</span>, <span class="st">"first"</span>, <span class="st">"last"</span>),
        <span class="co"># Control the size of each arrow head</span>
        <span class="kw">length</span> <span class="kw">=</span> <span class="fu">unit</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">1</span>, <span class="fl">6</span>), <span class="st">"pt"</span>),
        <span class="kw">type</span> <span class="kw">=</span> <span class="st">"closed"</span>
        ),
      <span class="co"># Use 'sharp' arrow heads</span>
      <span class="kw">linejoin</span> <span class="kw">=</span> <span class="st">'mitre'</span>)
<span class="no">fig_A</span></pre></body></html></div>
<p><img src="group-02_Piping-single-panel-ggplot-figs_files/figure-html/panel_A-1.png" width="700"></p>
<div id="congratulations-you-finished-part-2" class="section level3">
<h3 class="hasAnchor">
<a href="#congratulations-you-finished-part-2" class="anchor"></a>Congratulations! You finished part 2!!</h3>
<p>Now check out <a href="https://flightlab.github.io/MultiPanelPlotsWithR/articles/group-03_Using-cowplot-multi-panel.html">part 3</a></p>
<p>🐢</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.vikram-baliga.com/">Vikram B. Baliga</a>, <a href="https://www.andreagaede.com/">Andrea Gaede</a>, <a href="https://www.grad.ubc.ca/campus-community/meet-our-students/press-eric">Eric R. Press</a>, <a href="https://www.zoology.ubc.ca/person/shreeram-senthivasan/">Shree Senthivasan</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
